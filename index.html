<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Warranty Registration Check</title>

  <style>
    * { box-sizing: border-box; }

    body {
      font-family: system-ui, -apple-system, Segoe UI, sans-serif;
      font-size: 16px;
      color: #1a1a1a;
      margin: 0;
      padding: 0 16px;
      min-height: 100vh;

      background-color: #0f1216;
      background-image: url("/background-desktop.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    @media (max-width: 768px) {
      body {
        background-image: url("/background-mobile.jpg");
        background-attachment: scroll;
      }
    }

    h1 {
      margin-bottom: 8px;
      font-size: 28px;
      font-weight: 600;
    }

    .page {
      max-width: 760px;
      margin: 50px auto;
      padding: 20px 16px 32px;
      background: rgba(255, 255, 255, 0.75);
      border-radius: 8px;
    }

    .intro {
      margin-bottom: 24px;
      color: #444;
    }

    .lang-switch {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 16px;
    }

    .lang-switch button {
      background: transparent;
      border: 1px solid #999;
      padding: 4px 10px;
      font-size: 13px;
      cursor: pointer;
      border-radius: 4px;
      opacity: 0.6;
    }

    .lang-switch button.active {
      opacity: 1;
      font-weight: 600;
      border-color: #333;
    }

    .search-box {
      background: #fff;
      padding: 24px;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
      max-width: 520px;
    }

    .search-box label {
      display: block;
      font-weight: 500;
      margin-bottom: 6px;
    }

    .search-box input {
      width: 100%;
      font-size: 16px;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .search-box button {
      width: 100%;
      font-size: 16px;
      padding: 10px 16px;
      cursor: pointer;
      background: #1a73e8;
      color: #fff;
      border: none;
      border-radius: 4px;
    }

    .search-box button:hover {
      background: #155fc1;
    }

    .status {
      margin-top: 24px;
      padding: 16px;
      border-radius: 6px;
      font-weight: 500;
    }

    .status--found {
      background: #e6f4ea;
      color: #137333;
    }

    .status--not-found {
      background: #fdecea;
      color: #b3261e;
    }

    .record-primary {
      background: #fff;
      border-left: 4px solid #1a73e8;
      padding: 20px;
      margin-top: 16px;
      font-weight: 600;
    }

    .record-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 12px;
    }

    .duplicates-info {
      margin-top: 20px;
      font-size: 14px;
      color: #555;
    }

    .table-wrapper {
      overflow-x: auto;
      margin-top: 12px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      background: #fff;
    }

    th, td {
      border-bottom: 1px solid #ddd;
      padding: 8px 10px;
      text-align: left;
      font-size: 14px;
    }

    th {
      background: #f3f3f3;
    }

    .error {
      color: #b3261e;
      margin-top: 16px;
    }

    @media (max-width: 768px) {
      .record-grid { grid-template-columns: 1fr; }
    }

    .app-meta,
    .app-credits {
      margin-top: 16px;
      font-size: 12px;
      color: #666;
      text-align: right;
    }

    .app-credits {
      margin-top: 6px;
      color: #777;
    }

    .app-credits a {
      color: inherit;
      text-decoration: none;
      border-bottom: 1px dotted #999;
    }
  </style>
</head>

<body>
  <div class="page">

    <div class="lang-switch">
      <button id="lang-cz" class="active" type="button">CZ</button>
      <button id="lang-en" type="button">EN</button>
    </div>

    <h1></h1>
    <p class="intro"></p>

    <div class="search-box">
      <label for="serialInput"></label>
      <input id="serialInput" autocomplete="off" />
      <button id="checkButton" type="button"></button>
    </div>

    <div id="result"></div>

    <div class="app-meta" id="app-meta"></div>
    <div class="app-credits" id="app-credits"></div>

  </div>

  <script>
    const APP_META = {
      version: "1.0.0",
      lastUpdated: "2026-02-05"
    };

    let currentLang = "cz";
    let lastResultData = null;

    const i18n = {
      cz: {
        title: "Ověření registrace záruky",
        intro: "Zadejte sériové číslo produktu pro ověření, zda je registrován v systému záruk.",
        labelSerial: "Sériové číslo",
        placeholderSerial: "např. SN12345678",
        buttonCheck: "Ověřit záruku",
        errorEmpty: "Zadejte prosím sériové číslo.",
        notFound: "❌ Pro toto sériové číslo nebyla nalezena žádná registrace záruky.",
        found: "✅ Registrace záruky nalezena.",
        latest: "Poslední registrace",
        previousInfo: "ℹ️ Nalezeno více registrací. To se může stát při opakované registraci produktu.",
        product: "Produkt",
        registrationDate: "Datum registrace",
        purchaseDate: "Datum nákupu",
        country: "Země",
        note: "Poznámka",
        serverError: "Při komunikaci se serverem došlo k chybě.",
        meta: (m) => `Verze: v${m.version} · Poslední aktualizace: ${m.lastUpdated}`,
        credits: "Pomocí vibecodingu vytvořil"
      },
      en: {
        title: "Warranty Registration Check",
        intro: "Enter a product serial number to verify whether it has been registered for warranty.",
        labelSerial: "Serial number",
        placeholderSerial: "e.g. SN12345678",
        buttonCheck: "Check warranty",
        errorEmpty: "Please enter a serial number.",
        notFound: "❌ No warranty registration found for this serial number.",
        found: "✅ Warranty registration found.",
        latest: "Latest registration",
        previousInfo: "ℹ️ Multiple registrations were found. This can happen if the product was registered more than once.",
        product: "Product",
        registrationDate: "Registration date",
        purchaseDate: "Purchase date",
        country: "Country",
        note: "Note",
        serverError: "An error occurred while communicating with the server.",
        meta: (m) => `Version: v${m.version} · Last updated: ${m.lastUpdated}`,
        credits: "Vibecoded by"
      }
    };

    function renderStaticTexts() {
      const t = i18n[currentLang];
      document.querySelector("h1").textContent = t.title;
      document.querySelector(".intro").textContent = t.intro;
      document.querySelector("label[for='serialInput']").textContent = t.labelSerial;
      document.getElementById("serialInput").placeholder = t.placeholderSerial;
      document.getElementById("checkButton").textContent = t.buttonCheck;
      document.getElementById("app-meta").textContent = t.meta(APP_META);
      document.getElementById("app-credits").innerHTML =
        `${t.credits} <a href="https://www.janpavelka.com" target="_blank" rel="noopener">Jan Pavelka</a>`;
    }

    function renderResults(data) {
      const resultDiv = document.getElementById("result");
      const t = i18n[currentLang];

      if (!Array.isArray(data) || data.length === 0) {
        resultDiv.innerHTML = `<div class="status status--not-found">${t.notFound}</div>`;
        return;
      }

      data.sort((a, b) =>
        (b.registration_date || "").localeCompare(a.registration_date || "")
      );

      const primary = data[0];
      const others = data.slice(1);

      let html = `
        <div class="status status--found">${t.found}</div>
        <div class="record-primary">
          <strong>${t.latest}</strong>
          <div class="record-grid">
            <div><strong>${t.product}</strong><br>${primary.product_model || ""}</div>
            <div><strong>${t.registrationDate}</strong><br>${primary.registration_date || ""}</div>
            <div><strong>${t.purchaseDate}</strong><br>${primary.purchase_date || ""}</div>
            <div><strong>${t.country}</strong><br>${primary.country || ""}</div>
          </div>
        </div>
      `;

      if (others.length > 0) {
        html += `
          <div class="duplicates-info">${t.previousInfo}</div>
          <div class="table-wrapper">
            <table>
              <tr>
                <th>${t.registrationDate}</th>
                <th>${t.product}</th>
                <th>${t.country}</th>
                <th>${t.note}</th>
              </tr>
        `;
        for (const row of others) {
          html += `
            <tr>
              <td>${row.registration_date || ""}</td>
              <td>${row.product_model || ""}</td>
              <td>${row.country || ""}</td>
              <td>${row.source_note || ""}</td>
            </tr>
          `;
        }
        html += "</table></div>";
      }

      resultDiv.innerHTML = html;
    }

    async function checkWarranty() {
      const serial = document.getElementById("serialInput").value.trim();
      const resultDiv = document.getElementById("result");
      const t = i18n[currentLang];
      resultDiv.innerHTML = "";

      if (!serial) {
        resultDiv.innerHTML = `<p class="error">${t.errorEmpty}</p>`;
        return;
      }

      try {
        const response = await fetch(`/api/check?serial=${encodeURIComponent(serial)}`);
        const data = await response.json();
        lastResultData = data;
        renderResults(data);
      } catch {
        resultDiv.innerHTML = `<p class="error">${t.serverError}</p>`;
      }
    }

    function setLanguage(lang) {
      currentLang = lang;
      document.getElementById("lang-cz").classList.toggle("active", lang === "cz");
      document.getElementById("lang-en").classList.toggle("active", lang === "en");
      renderStaticTexts();
      if (lastResultData) renderResults(lastResultData);
    }

    document.getElementById("checkButton").addEventListener("click", checkWarranty);
    document.getElementById("serialInput").addEventListener("keydown", e => {
      if (e.key === "Enter") checkWarranty();
    });

    document.getElementById("lang-cz").addEventListener("click", () => setLanguage("cz"));
    document.getElementById("lang-en").addEventListener("click", () => setLanguage("en"));

    setLanguage("cz");
  </script>
</body>
</html>
